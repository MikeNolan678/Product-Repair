@model ProductRepairDataAccess.Models.ItemModel

@{
    ViewBag.Title = "Create Case";
}

<div class="container mt-5"

    <form method="post" asp-controller="CaseController" asp-action="NewCase" id="case-form">
        <div class="row">
            <div class="col">
                <div class="form-group">
                    <label for="caseId">Case ID:</label>
                    <input type="text" id="caseId" class="form-control" value="1234" disabled />
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label>Account:</label>
                    <input type="text" class="form-control" value="1234" disabled />
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label>Incident Type:</label>
                    <input type="text" class="form-control" value="1234" disabled />
                </div>
            </div>
        </div>
        <!-- Repeat similar structure for other properties -->
        <!-- Add Item Button -->
        <div class="form-group">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addItemModal">Add Item</button>
        </div>
    </form>

    <!-- Display added items -->
    <div id="addedItemsContainer"></div>
</div>

<!-- Add Item Modal -->
<div class="modal fade" id="addItemModal" tabindex="-1" role="dialog" aria-labelledby="addItemModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addItemModalLabel">Add Item</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @Html.Partial("_AddItemPartial")
            </div>
            <!-- You can add a footer with "Save" and "Cancel" buttons if needed -->
        </div>
    </div>
</div>

<div id="loading-spinner" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#addItemForm').on('submit', function (e) {
            e.preventDefault();

            // Serialize form data
            var formData = $(this).serialize();

            // Use AJAX to submit form and get the rendered item HTML
            $.post('@Url.Action("AddItem", "CaseController")', formData, function (data) {
                $('#addedItemsContainer').append(data);
            });

            // Clear form inputs and close the modal
            $('#addItemModal').modal('hide');
            $(this)[0].reset();
        });
    });
</script>
